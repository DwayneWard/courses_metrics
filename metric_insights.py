"""
–ú–æ–¥—É–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–π –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–µ—Ç–æ–¥–∏—Å—Ç–æ–≤.
–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö.
"""

from typing import Dict, List, Optional, Tuple
import pandas as pd
import numpy as np


class MetricInsights:
    """–ö–ª–∞—Å—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º –∫—É—Ä—Å–∞."""
    
    def __init__(self, analytics):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.
        
        Parameters:
        -----------
        analytics : CourseAnalytics
            –≠–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ CourseAnalytics —Å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
        """
        self.analytics = analytics
    
    def get_completion_insights(self) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –º–µ—Ç—Ä–∏–∫–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç.
        
        Returns:
        --------
        List[Dict] - —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫ —Å –ø–æ–ª—è–º–∏:
            - type: —Ç–∏–ø –ø–æ–¥—Å–∫–∞–∑–∫–∏ (warning, info, success)
            - metric: –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏
            - activity: –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            - message: —Ç–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏
            - recommendation: —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
        """
        insights = []
        completion_df = self.analytics.get_completion_rates()
        
        if len(completion_df) == 0:
            return insights
        
        # –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏
        LOW_COMPLETION_THRESHOLD = 50  # –ù–∏–∂–µ 50% - –∫—Ä–∏—Ç–∏—á–Ω–æ –Ω–∏–∑–∫–∞—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å
        MEDIUM_COMPLETION_THRESHOLD = 70  # 50-70% - —Å—Ä–µ–¥–Ω—è—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å
        
        for _, row in completion_df.iterrows():
            activity = row['–†–∞–±–æ—Ç–∞']
            completion_rate = row['–ü—Ä–æ—Ü–µ–Ω—Ç']
            completed = row['–í—ã–ø–æ–ª–Ω–∏–ª–∏']
            total = row['–í—Å–µ–≥–æ']
            work_type = row.get('–¢–∏–ø —Ä–∞–±–æ—Ç—ã', 'unknown')
            
            if completion_rate < LOW_COMPLETION_THRESHOLD:
                # –ö—Ä–∏—Ç–∏—á–Ω–æ –Ω–∏–∑–∫–∞—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å
                insights.append({
                    'type': 'warning',
                    'metric': '–ó–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å',
                    'activity': activity,
                    'value': f"{completion_rate:.1f}%",
                    'message': f"–ö—Ä–∏—Ç–∏—á–Ω–æ –Ω–∏–∑–∫–∞—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å: —Ç–æ–ª—å–∫–æ {completed} –∏–∑ {total} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Ä–∞–±–æ—Ç—É",
                    'recommendation': (
                        f"‚ö†Ô∏è –°—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å '{activity}': "
                        f"—Ç–æ–ª—å–∫–æ {completion_rate:.1f}% —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –µ—ë –≤—ã–ø–æ–ª–Ω–∏–ª–∏. "
                        f"–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã: —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è, "
                        f"–ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                        f"1) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É –∑–∞–¥–∞–Ω–∏—è –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏, "
                        f"2) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–æ—â–µ–Ω–∏—è –∏–ª–∏ —Ä–∞–∑–±–∏–µ–Ω–∏—è –Ω–∞ —ç—Ç–∞–ø—ã, "
                        f"3) –£—Å–∏–ª–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, "
                        f"4) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –æ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤."
                    )
                })
            elif completion_rate < MEDIUM_COMPLETION_THRESHOLD:
                # –°—Ä–µ–¥–Ω—è—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å
                insights.append({
                    'type': 'info',
                    'metric': '–ó–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å',
                    'activity': activity,
                    'value': f"{completion_rate:.1f}%",
                    'message': f"–°—Ä–µ–¥–Ω—è—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å: {completed} –∏–∑ {total} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Ä–∞–±–æ—Ç—É",
                    'recommendation': (
                        f"‚ÑπÔ∏è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å '{activity}' –∏–º–µ–µ—Ç —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç–∏ ({completion_rate:.1f}%). "
                        f"–≠—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Ç–æ, —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –≥—Ä–∞–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏. "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                        f"1) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ —Å—Ç—É–¥–µ–Ω—Ç—ã –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Ä–∞–±–æ—Ç—É –∏ –ø–æ—á–µ–º—É, "
                        f"2) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –∏–ª–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –¥–µ–¥–ª–∞–π–Ω–∞, "
                        f"3) –£–ª—É—á—à–∏—Ç—å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –æ –≤–∞–∂–Ω–æ—Å—Ç–∏ —ç—Ç–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –∫—É—Ä—Å–∞."
                    )
                })
            else:
                # –•–æ—Ä–æ—à–∞—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å, –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —É–ª—É—á—à–µ–Ω–∏—è
                if completion_rate < 90:
                    insights.append({
                        'type': 'success',
                        'metric': '–ó–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å',
                        'activity': activity,
                        'value': f"{completion_rate:.1f}%",
                        'message': f"–•–æ—Ä–æ—à–∞—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å: {completed} –∏–∑ {total} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Ä–∞–±–æ—Ç—É",
                        'recommendation': (
                            f"‚úÖ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å '{activity}' –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö–æ—Ä–æ—à—É—é –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å ({completion_rate:.1f}%), "
                            f"–Ω–æ –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è. "
                            f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã, –ø–æ—á–µ–º—É {total - completed} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Ä–∞–±–æ—Ç—É, "
                            f"–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —ç—Ç–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫ –¥—Ä—É–≥–∏–º —Ä–∞–±–æ—Ç–∞–º."
                        )
                    })
        
        return insights
    
    def get_engagement_trajectory_insights(self) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏.
        
        Returns:
        --------
        List[Dict] - —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
        """
        insights = []
        trajectory_df = self.analytics.get_engagement_trajectory()
        
        if len(trajectory_df) < 2:
            return insights
        
        # –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–∞
        first_pct = trajectory_df.iloc[0]['–ü—Ä–æ—Ü–µ–Ω—Ç']
        last_pct = trajectory_df.iloc[-1]['–ü—Ä–æ—Ü–µ–Ω—Ç']
        trend = last_pct - first_pct
        
        # –ê–Ω–∞–ª–∏–∑ —Ç–æ—á–∫–∏ –æ—Ç—Å–µ–≤–∞
        dropout = self.analytics.get_dropout_point()
        
        if dropout.get('point_found'):
            drop_work = dropout['work']
            drop_pct = dropout['drop_percentage']
            before_pct = dropout.get('before', 0)
            after_pct = dropout.get('after', 0)
            
            if drop_pct > 20:  # –ü–∞–¥–µ–Ω–∏–µ –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 20%
                insights.append({
                    'type': 'warning',
                    'metric': '–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏',
                    'activity': drop_work,
                    'value': f"–ü–∞–¥–µ–Ω–∏–µ –Ω–∞ {drop_pct:.1f}%",
                    'message': f"–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ç–æ—á–∫–∞ –æ—Ç—Å–µ–≤–∞: '{drop_work}'",
                    'recommendation': (
                        f"üö® –ö–†–ò–¢–ò–ß–ù–û: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Ç–æ—á–∫–∞ –æ—Ç—Å–µ–≤–∞ –Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ '{drop_work}'. "
                        f"–í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å —É–ø–∞–ª–∞ —Å {before_pct:.1f}% –¥–æ {after_pct:.1f}% (–ø–∞–¥–µ–Ω–∏–µ –Ω–∞ {drop_pct:.1f}%). "
                        f"–≠—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫—É—Ä—Å–æ–º –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ. "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ: "
                        f"1) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π —Ä–∞–±–æ—Ç—ã, "
                        f"2) –ü—Ä–æ–≤–µ—Å—Ç–∏ –æ–ø—Ä–æ—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –æ –ø—Ä–∏—á–∏–Ω–∞—Ö —Å–Ω–∏–∂–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, "
                        f"3) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫—É—Ä—Å–∞ –¥–æ —ç—Ç–æ–π —Ç–æ—á–∫–∏, "
                        f"4) –£—Å–∏–ª–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ —ç—Ç–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é, "
                        f"5) –í–æ–∑–º–æ–∂–Ω–æ, —Ä–∞–∑–±–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ —ç—Ç–∞–ø—ã –∏–ª–∏ –ø—Ä–æ–¥–ª–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω."
                    )
                })
            elif drop_pct > 10:
                insights.append({
                    'type': 'info',
                    'metric': '–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏',
                    'activity': drop_work,
                    'value': f"–ü–∞–¥–µ–Ω–∏–µ –Ω–∞ {drop_pct:.1f}%",
                    'message': f"–ó–∞–º–µ—á–µ–Ω–æ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ '{drop_work}'",
                    'recommendation': (
                        f"‚ö†Ô∏è –ù–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ '{drop_work}' –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è –∑–∞–º–µ—Ç–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ "
                        f"(–ø–∞–¥–µ–Ω–∏–µ –Ω–∞ {drop_pct:.1f}%). "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã –∏ –ø—Ä–∏–Ω—è—Ç—å –º–µ—Ä—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤."
                    )
                })
        
        # –ê–Ω–∞–ª–∏–∑ –æ–±—â–µ–≥–æ —Ç—Ä–µ–Ω–¥–∞
        if trend < -15:
            insights.append({
                'type': 'warning',
                'metric': '–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏',
                'activity': '–û–±—â–∏–π —Ç—Ä–µ–Ω–¥',
                'value': f"–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ {abs(trend):.1f}%",
                'message': "–û–±—â–µ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ –∫—É—Ä—Å—É",
                'recommendation': (
                    f"üìâ –û–±—â–∞—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ {abs(trend):.1f}% "
                    f"–æ—Ç –Ω–∞—á–∞–ª–∞ ({first_pct:.1f}%) –∫ –∫–æ–Ω—Ü—É ({last_pct:.1f}%). "
                    f"–≠—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –º–æ—Ç–∏–≤–∞—Ü–∏–µ–π —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏–ª–∏ –Ω–∞—Ä–∞—Å—Ç–∞—é—â—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫—É—Ä—Å–∞. "
                    f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                    f"1) –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞–ª–∞–Ω—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π, "
                    f"2) –£—Å–∏–ª–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –∏ –∫–æ–Ω—Ü–µ –∫—É—Ä—Å–∞, "
                    f"3) –î–æ–±–∞–≤–∏—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–±–æ–Ω—É—Å—ã, –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—é), "
                    f"4) –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –æ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤."
                )
                }
            )
        elif trend > 10:
            insights.append({
                'type': 'success',
                'metric': '–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏',
                'activity': '–û–±—â–∏–π —Ç—Ä–µ–Ω–¥',
                'value': f"–†–æ—Å—Ç –Ω–∞ {trend:.1f}%",
                'message': "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏",
                'recommendation': (
                    f"üìà –û—Ç–ª–∏—á–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞! –í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ {trend:.1f}% "
                    f"–æ—Ç –Ω–∞—á–∞–ª–∞ ({first_pct:.1f}%) –∫ –∫–æ–Ω—Ü—É ({last_pct:.1f}%). "
                    f"–≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—É—Ä—Å–∞ –∏ —Ö–æ—Ä–æ—à—É—é –º–æ—Ç–∏–≤–∞—Ü–∏—é —Å—Ç—É–¥–µ–Ω—Ç–æ–≤. "
                    f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Ö –≤ –¥—Ä—É–≥–∏—Ö –∫—É—Ä—Å–∞—Ö."
                )
                }
            )
        
        return insights
    
    def get_performance_insights(self) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –º–µ—Ç—Ä–∏–∫–µ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏.
        
        Returns:
        --------
        List[Dict] - —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
        """
        insights = []
        performance_df = self.analytics.get_performance_distribution()
        
        if len(performance_df) == 0:
            return insights
        
        # –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        LOW_SCORE_THRESHOLD = 5.0  # –ù–∏–∂–µ 5 - –Ω–∏–∑–∫–∞—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å
        HIGH_STD_THRESHOLD = 2.5  # –í—ã—Å–æ–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å
        
        for _, row in performance_df.iterrows():
            activity = row['–†–∞–±–æ—Ç–∞']
            mean_score = row['–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª']
            std_score = row['–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ']
            median_score = row.get('–ú–µ–¥–∏–∞–Ω–∞', mean_score)
            count = row.get('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫', 0)
            
            # –ê–Ω–∞–ª–∏–∑ —Å—Ä–µ–¥–Ω–µ–≥–æ –±–∞–ª–ª–∞
            if mean_score < LOW_SCORE_THRESHOLD:
                insights.append({
                    'type': 'warning',
                    'metric': '–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å',
                    'activity': activity,
                    'value': f"–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: {mean_score:.2f}",
                    'message': f"–ù–∏–∑–∫–∏–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: {mean_score:.2f}",
                    'recommendation': (
                        f"‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å '{activity}' –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∏–∑–∫–∏–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª ({mean_score:.2f}). "
                        f"–≠—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Ç–æ, —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–µ –∏–ª–∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏ —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ. "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                        f"1) –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏—è –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, "
                        f"2) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —É—Ä–æ–≤–Ω—é —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, "
                        f"3) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, "
                        f"4) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–±–æ—Ä—ã."
                    )
                })
            
            # –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–±—Ä–æ—Å–∞ –æ—Ü–µ–Ω–æ–∫
            if std_score > HIGH_STD_THRESHOLD:
                insights.append({
                    'type': 'info',
                    'metric': '–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å',
                    'activity': activity,
                    'value': f"–†–∞–∑–±—Ä–æ—Å: {std_score:.2f}",
                    'message': f"–í—ã—Å–æ–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å –æ—Ü–µ–Ω–æ–∫: {std_score:.2f}",
                    'recommendation': (
                        f"‚ÑπÔ∏è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å '{activity}' –∏–º–µ–µ—Ç –≤—ã—Å–æ–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å –æ—Ü–µ–Ω–æ–∫ (œÉ={std_score:.2f}). "
                        f"–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å–∏–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è. "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                        f"1) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –ø–æ—á–µ–º—É –æ–¥–Ω–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ö–æ—Ä–æ—à–æ, –∞ –¥—Ä—É–≥–∏–µ –ø–ª–æ—Ö–æ, "
                        f"2) –£—Å–∏–ª–∏—Ç—å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —Å–∏–ª—å–Ω—ã—Ö, "
                        f"–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å –¥–ª—è —Å–ª–∞–±—ã—Ö), "
                        f"3) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–∞–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–º –¥–ª—è —á–∞—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤."
                    )
                })
            elif std_score < 1.0 and mean_score < 6:
                # –ù–∏–∑–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å + –Ω–∏–∑–∫–∏–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª = –∑–∞–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–µ –¥–ª—è –≤—Å–µ—Ö
                insights.append({
                    'type': 'warning',
                    'metric': '–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å',
                    'activity': activity,
                    'value': f"–ù–∏–∑–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å –ø—Ä–∏ –Ω–∏–∑–∫–æ–º —Å—Ä–µ–¥–Ω–µ–º",
                    'message': "–ó–∞–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–µ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤",
                    'recommendation': (
                        f"‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å '{activity}' –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∏–∑–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å –æ—Ü–µ–Ω–æ–∫ (œÉ={std_score:.2f}) "
                        f"–ø—Ä–∏ –Ω–∏–∑–∫–æ–º —Å—Ä–µ–¥–Ω–µ–º –±–∞–ª–ª–µ ({mean_score:.2f}). "
                        f"–≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–µ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤. "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                        f"1) –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –∏–ª–∏ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —ç—Ç–∞–ø—ã, "
                        f"2) –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –ø—Ä–∏–º–µ—Ä–æ–≤, "
                        f"3) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞."
                    )
                })
            
            # –ê–Ω–∞–ª–∏–∑ –º–µ–¥–∏–∞–Ω—ã vs —Å—Ä–µ–¥–Ω–µ–≥–æ
            if abs(mean_score - median_score) > 1.5:
                if mean_score > median_score:
                    insights.append({
                        'type': 'info',
                        'metric': '–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å',
                        'activity': activity,
                        'value': f"–°—Ä–µ–¥–Ω–µ–µ ({mean_score:.2f}) > –ú–µ–¥–∏–∞–Ω–∞ ({median_score:.2f})",
                        'message': "–ù–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∏–ª–∏ –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–µ –æ—Ü–µ–Ω–∫–∏",
                        'recommendation': (
                            f"‚ÑπÔ∏è –í –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ '{activity}' —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª ({mean_score:.2f}) –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤—ã—à–µ –º–µ–¥–∏–∞–Ω—ã ({median_score:.2f}). "
                            f"–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∏–ª–∏ –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–µ –æ—Ü–µ–Ω–∫–∏, "
                            f"–ø–æ–¥—Ç—è–≥–∏–≤–∞—è —Å—Ä–µ–¥–Ω–µ–µ –≤–≤–µ—Ä—Ö. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                            f"1) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –ø–æ–º–æ–≥–ª–æ —É—Å–ø–µ—à–Ω—ã–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º, "
                            f"2) –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Ö –ø–æ–¥—Ö–æ–¥—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö, "
                            f"3) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –¥–ª—è —Å–∏–ª—å–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤."
                        )
                    })
                else:
                    insights.append({
                        'type': 'warning',
                        'metric': '–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å',
                        'activity': activity,
                        'value': f"–°—Ä–µ–¥–Ω–µ–µ ({mean_score:.2f}) < –ú–µ–¥–∏–∞–Ω–∞ ({median_score:.2f})",
                        'message': "–ù–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∏–ª–∏ –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–µ –æ—Ü–µ–Ω–∫–∏",
                        'recommendation': (
                            f"‚ö†Ô∏è –í –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ '{activity}' —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª ({mean_score:.2f}) –Ω–∏–∂–µ –º–µ–¥–∏–∞–Ω—ã ({median_score:.2f}). "
                            f"–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∏–ª–∏ –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–µ –æ—Ü–µ–Ω–∫–∏. "
                            f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                            f"1) –í—ã—è–≤–∏—Ç—å —ç—Ç–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É, "
                            f"2) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã –Ω–∏–∑–∫–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, "
                            f"3) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –∏–ª–∏ –ø–µ—Ä–µ—Å–¥–∞—á–∏."
                        )
                    })
        
        return insights
    
    def get_progress_insights(self) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.
        
        Returns:
        --------
        List[Dict] - —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
        """
        insights = []
        progress_summary = self.analytics.get_progress_summary()
        
        if not progress_summary:
            return insights
        
        improved = progress_summary.get('–£–ª—É—á—à–∏–ª–æ—Å—å', 0)
        declined = progress_summary.get('–£—Ö—É–¥—à–∏–ª–æ—Å—å', 0)
        stable = progress_summary.get('–°—Ç–∞–±–∏–ª—å–Ω–æ', 0)
        total = improved + declined + stable
        
        if total == 0:
            return insights
        
        improved_pct = (improved / total * 100) if total > 0 else 0
        declined_pct = (declined / total * 100) if total > 0 else 0
        
        # –ê–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —É–ª—É—á—à–∏–≤—à–∏—Ö—Å—è –∏ —É—Ö—É–¥—à–∏–≤—à–∏—Ö—Å—è
        if declined_pct > 50:
            insights.append({
                'type': 'warning',
                'metric': '–ü—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤',
                'activity': '–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å',
                'value': f"{declined_pct:.1f}% —É—Ö—É–¥—à–∏–ª–∏—Å—å",
                'message': f"–ë–æ–ª—å—à–µ –ø–æ–ª–æ–≤–∏–Ω—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ ({declined_pct:.1f}%) –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Ö—É–¥—à–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤",
                'recommendation': (
                    f"‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: {declined_pct:.1f}% —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Ö—É–¥—à–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –∫—É—Ä—Å—É, "
                    f"—Ç–æ–ª—å–∫–æ {improved_pct:.1f}% —É–ª—É—á—à–∏–ª–∏—Å—å. "
                    f"–≠—Ç–æ —Å–µ—Ä—å–µ–∑–Ω—ã–π —Å–∏–≥–Ω–∞–ª –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫—É—Ä—Å–æ–º. "
                    f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                    f"1) –°—Ä–æ—á–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω —É—Ö—É–¥—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, "
                    f"2) –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—É—Ä—Å–∞ –∏ –±–∞–ª–∞–Ω—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, "
                    f"3) –£—Å–∏–ª–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –∏ –∫–æ–Ω—Ü–µ –∫—É—Ä—Å–∞, "
                    f"4) –ü—Ä–æ–≤–µ—Å—Ç–∏ –æ–ø—Ä–æ—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—è—Ö, "
                    f"5) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è."
                )
            })
        elif improved_pct < 30:
            insights.append({
                'type': 'info',
                'metric': '–ü—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤',
                'activity': '–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å',
                'value': f"–¢–æ–ª—å–∫–æ {improved_pct:.1f}% —É–ª—É—á—à–∏–ª–∏—Å—å",
                'message': "–ù–∏–∑–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å —É–ª—É—á—à–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤",
                'recommendation': (
                    f"‚ÑπÔ∏è –¢–æ–ª—å–∫–æ {improved_pct:.1f}% —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É–ª—É—á—à–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. "
                    f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã –∏ —É—Å–∏–ª–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞."
                )
            }
            )
        
        # –ê–Ω–∞–ª–∏–∑ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        avg_progress = progress_summary.get('–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å', 0)
        if avg_progress < -1.0:
            insights.append({
                'type': 'warning',
                'metric': '–ü—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤',
                'activity': '–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å',
                'value': f"{avg_progress:.2f}",
                'message': "–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π",
                'recommendation': (
                    f"‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π ({avg_progress:.2f} –±–∞–ª–ª–∞). "
                    f"–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ —Å—Ä–µ–¥–Ω–µ–º —Å—Ç—É–¥–µ–Ω—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ö—É–¥—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫–æ–Ω—Ü–µ –∫—É—Ä—Å–∞, "
                    f"—á–µ–º –≤ –Ω–∞—á–∞–ª–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫—É—Ä—Å–∞."
                )
            })
        elif avg_progress > 1.0:
            insights.append({
                'type': 'success',
                'metric': '–ü—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤',
                'activity': '–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å',
                'value': f"+{avg_progress:.2f}",
                'message': "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å",
                'recommendation': (
                    f"‚úÖ –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π (+{avg_progress:.2f} –±–∞–ª–ª–∞). "
                    f"–≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ –Ω–∞–≤—ã–∫–æ–≤ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤."
                )
            })
        
        return insights
    
    def get_correlation_insights(self) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è–º –º–µ–∂–¥—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º–∏.
        
        Returns:
        --------
        List[Dict] - —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
        """
        insights = []
        corr_matrix = self.analytics.get_correlations()
        
        if len(corr_matrix) < 2:
            return insights
        
        # –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        STRONG_CORRELATION = 0.6
        WEAK_CORRELATION = 0.3
        
        # –ê–Ω–∞–ª–∏–∑ —Å–∏–ª—å–Ω—ã—Ö –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π
        from itertools import combinations
        strong_pairs = []
        weak_pairs = []
        
        for w1, w2 in combinations(corr_matrix.index, 2):
            corr_value = corr_matrix.loc[w1, w2]
            if pd.isna(corr_value):
                continue
            
            if abs(corr_value) >= STRONG_CORRELATION:
                strong_pairs.append((w1, w2, corr_value))
            elif abs(corr_value) < WEAK_CORRELATION:
                weak_pairs.append((w1, w2, corr_value))
        
        # –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Å–∏–ª—å–Ω—ã–º –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è–º
        if strong_pairs:
            # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–∏–ø–∞–º —Ä–∞–±–æ—Ç
            work_types = {
                name: self.analytics.work_data.get(name, {}).get('work_type', 'unknown')
                for name in corr_matrix.index
            }
            
            for w1, w2, corr in strong_pairs[:3]:  # –ë–µ—Ä–µ–º —Ç–æ–ø-3
                t1 = work_types.get(w1, 'unknown')
                t2 = work_types.get(w2, 'unknown')
                
                if corr > 0:
                    insights.append({
                        'type': 'success',
                        'metric': '–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏',
                        'activity': f"{w1} ‚Üî {w2}",
                        'value': f"{corr:.2f}",
                        'message': f"–°–∏–ª—å–Ω–∞—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º–∏",
                        'recommendation': (
                            f"‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å–∏–ª—å–Ω–∞—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è ({corr:.2f}) –º–µ–∂–¥—É "
                            f"'{w1}' –∏ '{w2}'. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å—Ç—É–¥–µ–Ω—Ç—ã, —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–≤—à–∏–µ –æ–¥–Ω—É —Ä–∞–±–æ—Ç—É, "
                            f"–æ–±—ã—á–Ω–æ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç –∏ –¥—Ä—É–≥—É—é. "
                            f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                            f"1) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ–¥–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –¥—Ä—É–≥–æ–π, "
                            f"2) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–∞–≤—ã–∫–æ–≤, "
                            f"3) –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ—Ö–æ–∂–∏–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –¥—Ä—É–≥–∏–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º."
                        )
                    })
                else:
                    insights.append({
                        'type': 'warning',
                        'metric': '–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏',
                        'activity': f"{w1} ‚Üî {w2}",
                        'value': f"{corr:.2f}",
                        'message': f"–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º–∏",
                        'recommendation': (
                            f"‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è ({corr:.2f}) –º–µ–∂–¥—É "
                            f"'{w1}' –∏ '{w2}'. –≠—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏–ª–∏ "
                            f"—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –Ω–∞–≤—ã–∫–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã –∏ "
                            f"—Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –ø–æ–¥—Ö–æ–¥–æ–≤."
                        )}
                    )
        
        # –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Å–ª–∞–±—ã–º –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è–º
        if len(weak_pairs) > len(strong_pairs) * 2:
            insights.append({
                'type': 'info',
                'metric': '–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏',
                'activity': '–û–±—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∞',
                'value': f"–ú–Ω–æ–≥–æ —Å–ª–∞–±—ã—Ö —Å–≤—è–∑–µ–π",
                'message': "–ú–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π —Å –Ω–∏–∑–∫–æ–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π",
                'recommendation': (
                    f"‚ÑπÔ∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –º–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π —Å –Ω–∏–∑–∫–æ–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π. "
                    f"–≠—Ç–æ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å, —á—Ç–æ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–∞–∑–Ω—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –∏–ª–∏ "
                    f"—Ç—Ä–µ–±—É—é—Ç —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, "
                    f"—è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –æ–∂–∏–¥–∞–µ–º—ã–º –¥–ª—è –∫—É—Ä—Å–∞ –∏–ª–∏ —Å—Ç–æ–∏—Ç —É—Å–∏–ª–∏—Ç—å —Å–≤—è–∑—å –º–µ–∂–¥—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º–∏."
                )}
            )
        
        return insights
    
    def get_consistency_insights(self) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
        
        Returns:
        --------
        List[Dict] - —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
        """
        insights = []
        consistency_df = self.analytics.get_consistency()
        
        if len(consistency_df) == 0:
            return insights
        
        # –ê–Ω–∞–ª–∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        if '–ö–∞—Ç–µ–≥–æ—Ä–∏—è' in consistency_df.columns:
            category_counts = consistency_df['–ö–∞—Ç–µ–≥–æ—Ä–∏—è'].value_counts()
            total = len(consistency_df)
            
            # –ê–Ω–∞–ª–∏–∑ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
            unstable_count = category_counts.get('–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π', 0)
            unstable_pct = (unstable_count / total * 100) if total > 0 else 0
            
            if unstable_pct > 25:
                insights.append({
                    'type': 'warning',
                    'metric': '–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å',
                    'activity': '–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã',
                    'value': f"{unstable_pct:.1f}%",
                    'message': f"–í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤: {unstable_pct:.1f}%",
                    'recommendation': (
                        f"‚ö†Ô∏è {unstable_pct:.1f}% —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã "
                        f"(—Å–∏–ª—å–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è –º–µ–∂–¥—É —Ä–∞–±–æ—Ç–∞–º–∏). "
                        f"–≠—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –º–æ—Ç–∏–≤–∞—Ü–∏–µ–π, –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∏–ª–∏ "
                        f"–Ω–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö. "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                        f"1) –í—ã—è–≤–∏—Ç—å —ç—Ç–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É, "
                        f"2) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏, "
                        f"3) –£–ª—É—á—à–∏—Ç—å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö –∏ –∫—Ä–∏—Ç–µ—Ä–∏—è—Ö –æ—Ü–µ–Ω–∫–∏, "
                        f"4) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±–æ–ª–µ–µ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö —Ç–æ—á–µ–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞."
                    )
                })
            
            # –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö
            unsuccessful_count = category_counts.get('—Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–µ—É—Å–ø–µ—à–Ω—ã–π', 0)
            unsuccessful_pct = (unsuccessful_count / total * 100) if total > 0 else 0
            
            if unsuccessful_pct > 10:
                insights.append({
                    'type': 'warning',
                    'metric': '–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å',
                    'activity': '–°—Ç–∞–±–∏–ª—å–Ω–æ –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã',
                    'value': f"{unsuccessful_pct:.1f}%",
                    'message': f"–ì—Ä—É–ø–ø–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏ –Ω–∏–∑–∫–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏: {unsuccessful_pct:.1f}%",
                    'recommendation': (
                        f"‚ö†Ô∏è {unsuccessful_pct:.1f}% —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∏–∑–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. "
                        f"–≠—Ç–∏–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º –Ω—É–∂–Ω–∞ –æ—Å–æ–±–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞. "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                        f"1) –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, "
                        f"2) –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –∑–∞–¥–∞–Ω–∏—è, "
                        f"3) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–∞ –æ—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, "
                        f"4) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫—É—Ä—Å —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–º –¥–ª—è —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã."
                    )
                })
            
            # –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞–±–∏–ª—å–Ω–æ —É—Å–ø–µ—à–Ω—ã—Ö
            successful_count = category_counts.get('—Å—Ç–∞–±–∏–ª—å–Ω–æ —É—Å–ø–µ—à–Ω—ã–π', 0)
            successful_pct = (successful_count / total * 100) if total > 0 else 0
            
            if successful_pct > 40:
                insights.append({
                    'type': 'success',
                    'metric': '–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å',
                    'activity': '–°—Ç–∞–±–∏–ª—å–Ω–æ —É—Å–ø–µ—à–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã',
                    'value': f"{successful_pct:.1f}%",
                    'message': f"–•–æ—Ä–æ—à–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —É—Å–ø–µ—à–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤: {successful_pct:.1f}%",
                    'recommendation': (
                        f"‚úÖ {successful_pct:.1f}% —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤—ã—Å–æ–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. "
                        f"–≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—É—Ä—Å–∞ –¥–ª—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤. "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                        f"1) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —ç—Ç–∏–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º, "
                        f"2) –ü—Ä–∏–º–µ–Ω–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö, "
                        f"3) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã."
                    )
                })
        
        return insights
    
    def get_difficulty_insights(self) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π.
        
        Returns:
        --------
        List[Dict] - —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
        """
        insights = []
        difficulty_df = self.analytics.get_difficulty_comparison()
        
        if len(difficulty_df) == 0:
            return insights
        
        # –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—É—é —Å–ª–æ–∂–Ω—É—é –∏ —Å–∞–º—É—é –ø—Ä–æ—Å—Ç—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        difficulty_df_sorted = difficulty_df.sort_values('–ò–Ω–¥–µ–∫—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏', ascending=False)
        
        hardest = difficulty_df_sorted.iloc[0]
        easiest = difficulty_df_sorted.iloc[-1]
        
        hardest_index = hardest['–ò–Ω–¥–µ–∫—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏']
        easiest_index = easiest['–ò–Ω–¥–µ–∫—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏']
        
        # –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –±–æ–ª—å—à–∞—è, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π
        if hardest_index - easiest_index > 0.5:
            insights.append({
                'type': 'warning',
                'metric': '–°–ª–æ–∂–Ω–æ—Å—Ç—å',
                'activity': hardest['–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å'],
                'value': f"–ò–Ω–¥–µ–∫—Å: {hardest_index:.2f}",
                'message': f"–°–∞–º–∞—è —Å–ª–æ–∂–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: '{hardest['–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å']}'",
                'recommendation': (
                    f"‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å '{hardest['–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å']}' –∏–º–µ–µ—Ç —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –∏–Ω–¥–µ–∫—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ ({hardest_index:.2f}), "
                    f"–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–≤—ã—à–∞—é—â–∏–π –¥—Ä—É–≥–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Ä–∞–∑–Ω–∏—Ü–∞ —Å —Å–∞–º–æ–π –ø—Ä–æ—Å—Ç–æ–π: {hardest_index - easiest_index:.2f}). "
                    f"–≠—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤. "
                    f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                    f"1) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –ø–æ—á–µ–º—É —ç—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–∞–∫ —Å–ª–æ–∂–Ω–∞ (–Ω–∏–∑–∫–∞—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å: {hardest['–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è']:.1f}%, "
                    f"–Ω–∏–∑–∫–∏–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: {hardest['–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª']:.2f}), "
                    f"2) –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–æ—â–µ–Ω–∏—è –∏–ª–∏ —Ä–∞–∑–±–∏–µ–Ω–∏—è –Ω–∞ —ç—Ç–∞–ø—ã, "
                    f"3) –£—Å–∏–ª–∏—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ —ç—Ç–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é, "
                    f"4) –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –ø—Ä–∏–º–µ—Ä—ã."
                )
            })
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
        if easiest_index < 0.2:
            insights.append({
                'type': 'info',
                'metric': '–°–ª–æ–∂–Ω–æ—Å—Ç—å',
                'activity': easiest['–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å'],
                'value': f"–ò–Ω–¥–µ–∫—Å: {easiest_index:.2f}",
                'message': f"–°–∞–º–∞—è –ø—Ä–æ—Å—Ç–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: '{easiest['–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å']}'",
                'recommendation': (
                    f"‚ÑπÔ∏è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å '{easiest['–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å']}' –∏–º–µ–µ—Ç –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–π –∏–Ω–¥–µ–∫—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ ({easiest_index:.2f}). "
                    f"–≠—Ç–æ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å, —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–µ –∏ –Ω–µ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç –Ω–∞–≤—ã–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤. "
                    f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π."
                )
            })
        
        return insights
    
    def get_variability_insights(self) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –æ—Ü–µ–Ω–æ–∫.
        
        Returns:
        --------
        List[Dict] - —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
        """
        insights = []
        variability_df = self.analytics.get_variability_analysis()
        
        if len(variability_df) == 0:
            return insights
        
        # –ê–Ω–∞–ª–∏–∑ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∞–∑–±—Ä–æ—Å–∞
        high_variability = variability_df[variability_df['–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏'] > 0.3]
        
        if len(high_variability) > 0:
            for _, row in high_variability.iterrows():
                activity = row['–†–∞–±–æ—Ç–∞']
                cv = row['–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏']
                mean = row['–°—Ä–µ–¥–Ω–µ–µ']
                
                insights.append({
                    'type': 'info',
                    'metric': '–í–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å',
                    'activity': activity,
                    'value': f"CV: {cv:.2f}",
                    'message': f"–í—ã—Å–æ–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å –æ—Ü–µ–Ω–æ–∫: {cv:.2f}",
                    'recommendation': (
                        f"‚ÑπÔ∏è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å '{activity}' –∏–º–µ–µ—Ç –≤—ã—Å–æ–∫–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ ({cv:.2f}), "
                        f"—á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –±–æ–ª—å—à–æ–π —Ä–∞–∑–±—Ä–æ—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤. "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: "
                        f"1) –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã —Ä–∞–∑–ª–∏—á–∏–π –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö, "
                        f"2) –£—Å–∏–ª–∏—Ç—å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, "
                        f"3) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–∞–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–º –¥–ª—è —á–∞—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤."
                    )
                })
        
        # –ê–Ω–∞–ª–∏–∑ –Ω–∏–∑–∫–æ–≥–æ —Ä–∞–∑–±—Ä–æ—Å–∞ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º —Å—Ä–µ–¥–Ω–µ–º
        low_variability_low_mean = variability_df[
            (variability_df['–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏'] < 0.1) & 
            (variability_df['–°—Ä–µ–¥–Ω–µ–µ'] < 6)
        ]
        
        if len(low_variability_low_mean) > 0:
            for _, row in low_variability_low_mean.iterrows():
                activity = row['–†–∞–±–æ—Ç–∞']
                cv = row['–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏']
                mean = row['–°—Ä–µ–¥–Ω–µ–µ']
                
                insights.append({
                    'type': 'warning',
                    'metric': '–í–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å',
                    'activity': activity,
                    'value': f"CV: {cv:.2f}, –°—Ä–µ–¥–Ω–µ–µ: {mean:.2f}",
                    'message': "–ù–∏–∑–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å –ø—Ä–∏ –Ω–∏–∑–∫–æ–º —Å—Ä–µ–¥–Ω–µ–º - –∑–∞–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–µ",
                    'recommendation': (
                        f"‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å '{activity}' –∏–º–µ–µ—Ç –Ω–∏–∑–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å (CV={cv:.2f}) –ø—Ä–∏ –Ω–∏–∑–∫–æ–º —Å—Ä–µ–¥–Ω–µ–º –±–∞–ª–ª–µ ({mean:.2f}). "
                        f"–≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–µ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤. "
                        f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è."
                    )
                })
        
        return insights
    
    def get_all_insights(self) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –≤—Å–µ–º –º–µ—Ç—Ä–∏–∫–∞–º.
        
        Returns:
        --------
        List[Dict] - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
        """
        all_insights = []
        
        # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
        all_insights.extend(self.get_completion_insights())
        all_insights.extend(self.get_engagement_trajectory_insights())
        all_insights.extend(self.get_performance_insights())
        all_insights.extend(self.get_progress_insights())
        all_insights.extend(self.get_correlation_insights())
        all_insights.extend(self.get_consistency_insights())
        all_insights.extend(self.get_difficulty_insights())
        all_insights.extend(self.get_variability_insights())
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É: warning > info > success
        priority = {'warning': 0, 'info': 1, 'success': 2}
        all_insights.sort(key=lambda x: priority.get(x.get('type', 'info'), 1))
        
        return all_insights
    
    def format_insights_for_display(self, insights: Optional[List[Dict]] = None) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        
        Parameters:
        -----------
        insights : List[Dict], optional
            –°–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏.
        
        Returns:
        --------
        str - –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏
        """
        if insights is None:
            insights = self.get_all_insights()
        
        if not insights:
            return "–ù–µ—Ç –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è."
        
        output = []
        output.append("=" * 80)
        output.append("–ü–û–î–°–ö–ê–ó–ö–ò –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ú–ï–¢–†–ò–ö–ê–ú –ö–£–†–°–ê")
        output.append("=" * 80)
        output.append("")
        
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–∏–ø–∞–º
        warnings = [i for i in insights if i.get('type') == 'warning']
        infos = [i for i in insights if i.get('type') == 'info']
        successes = [i for i in insights if i.get('type') == 'success']
        
        if warnings:
            output.append("üö® –ö–†–ò–¢–ò–ß–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ (—Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è):")
            output.append("-" * 80)
            for i, insight in enumerate(warnings, 1):
                output.append(f"\n{i}. {insight.get('metric')} - {insight.get('activity')}")
                output.append(f"   –ó–Ω–∞—á–µ–Ω–∏–µ: {insight.get('value', 'N/A')}")
                output.append(f"   {insight.get('message', '')}")
                output.append(f"   {insight.get('recommendation', '')}")
            output.append("")
        
        if infos:
            output.append("‚ÑπÔ∏è –ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø:")
            output.append("-" * 80)
            for i, insight in enumerate(infos, 1):
                output.append(f"\n{i}. {insight.get('metric')} - {insight.get('activity')}")
                output.append(f"   –ó–Ω–∞—á–µ–Ω–∏–µ: {insight.get('value', 'N/A')}")
                output.append(f"   {insight.get('message', '')}")
                output.append(f"   {insight.get('recommendation', '')}")
            output.append("")
        
        if successes:
            output.append("‚úÖ –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–´–ï –ú–û–ú–ï–ù–¢–´:")
            output.append("-" * 80)
            for i, insight in enumerate(successes, 1):
                output.append(f"\n{i}. {insight.get('metric')} - {insight.get('activity')}")
                output.append(f"   –ó–Ω–∞—á–µ–Ω–∏–µ: {insight.get('value', 'N/A')}")
                output.append(f"   {insight.get('message', '')}")
                output.append(f"   {insight.get('recommendation', '')}")
            output.append("")
        
        output.append("=" * 80)
        
        return "\n".join(output)

